function update(){Array.from(document.getElementsByClassName("draggable")).forEach(function(e){var t=0,n=0,o=0,d=0;function l(l){(l=l||window.event).preventDefault(),t=o-l.clientX,n=d-l.clientY,o=l.clientX,d=l.clientY;var c=e.offsetTop-n,a=e.offsetLeft-t,i=e.childNodes[3].getBoundingClientRect().right,s=e.childNodes[3].getBoundingClientRect().bottom;c>150&&a>0&&i+3<(window.innerWidth||document.documentElement.clientWidth)&&s<(window.innerHeight||document.documentElement.clientHeight)-6?(e.style.top=c+"px",e.style.left=a+"px"):i+3>=(window.innerWidth||document.documentElement.clientWidth)?e.style.left=e.offsetLeft-1+"px":s>=(window.innerHeight||document.documentElement.clientHeight)-6&&(e.style.top=e.offsetTop-1+"px")}function c(){document.onmouseup=null,document.onmousemove=null}e.childNodes[1].onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,d=e.clientY,document.onmouseup=c,document.onmousemove=l}})}function postItSyncEle(e,t){var n=e.id,o=e.getBoundingClientRect().top,d=e.getBoundingClientRect().left,l=e.childNodes[3].getBoundingClientRect().width,c=e.childNodes[3].getBoundingClientRect().height,a=e.childNodes[3].style.backgroundColor,i=e.style.zIndex,s=e.childNodes[3].value,r=document.cookie,m=e.childNodes[1].childNodes[7].innerHTML;return json={id:n,top:o,left:d,width:l,height:c,color:a,zIndex:i,content:s,cookie:r,author:m,send_type:t},json}function createPostIt(e){var t=0;$(".draggable").each(function(){t=Math.max(this.id,t)});var n=document.createElement("div"),o=document.createElement("div"),d=document.createElement("h3"),l=document.createTextNode(e),c=document.createElement("textarea"),a=document.createElement("img"),i=document.createElement("div"),s=document.createElement("img"),r=document.createElement("ul"),m=document.createElement("li"),p=document.createElement("li"),u=document.createElement("li"),h=document.createElement("button"),g=document.createElement("div"),E=document.createElement("button"),C=document.createElement("ul"),N=document.createElement("li"),w=document.createElement("li"),y=document.createElement("li"),f=document.createElement("li"),b=document.createElement("li"),x=document.createElement("li"),v=document.createElement("li"),k=document.createElement("button"),I=document.createElement("button"),T=document.createElement("button"),L=document.createElement("button"),B=document.createElement("button"),A=document.createElement("button"),H=document.createElement("button"),M=document.createElement("div"),S=document.createElement("button"),D=document.createElement("ul"),_=document.createElement("li"),z=document.createElement("li"),O=document.createElement("button"),J=document.createElement("button"),P=document.createElement("br"),R=document.createTextNode(""),U=document.createTextNode(""),W=document.createTextNode(""),X=document.createTextNode(""),G=document.createTextNode(""),Y=document.createTextNode(""),j=document.createTextNode(""),Z=document.createTextNode(""),V=document.createTextNode(""),q=document.createTextNode(""),F=document.createTextNode(""),K=document.createTextNode(""),Q=document.createTextNode(""),ee=document.createTextNode(""),te=document.createTextNode(""),ne=document.createTextNode(""),oe=document.createTextNode(""),de=document.createTextNode("");return n.className="draggable",n.id=t+1,n.style.zIndex=0,n.style.backgroundColor="lightblue",n.style.top="150px",o.className="author",c.className="textarea",c.style.backgroundColor="lightblue",a.className="thumbtacks",a.src=thumbtackUrl,s.src=optionsUrl,i.className="dropdown",i.addEventListener("click",function(e){var t=(e=e||window.event).target;t.textContent||t.innerText;t.parentElement.classList.toggle("show")}),h.className="listbutton deleteButton",h.innerHTML="Delete",k.className="listbutton",k.setAttribute("onClick","changeColor(this)"),k.innerHTML="lightblue",I.className="listbutton",I.setAttribute("onClick","changeColor(this)"),I.innerHTML="pink",T.className="listbutton",T.setAttribute("onClick","changeColor(this)"),T.innerHTML="yellow",L.className="listbutton",L.setAttribute("onClick","changeColor(this)"),L.innerHTML="lightgreen",B.className="listbutton",B.setAttribute("onClick","changeColor(this)"),B.innerHTML="orange",A.className="listbutton",A.setAttribute("onClick","changeColor(this)"),A.innerHTML="purple",H.className="listbutton",H.setAttribute("onClick","changeColor(this)"),H.innerHTML="olive",N.appendChild(k),w.appendChild(I),y.appendChild(T),f.appendChild(L),b.appendChild(B),x.appendChild(A),v.appendChild(H),g.className="dropdowncolor",E.className="listbutton",E.innerHTML="Color >",E.setAttribute("onClick","showDropdownColor(this)"),O.className="listbutton",O.setAttribute("onClick","indexUp(this)"),O.innerHTML="Up +",J.className="listbutton",J.setAttribute("onClick","indexDown(this)"),J.innerHTML="Down -",_.appendChild(O),z.appendChild(J),M.className="dropdownground",S.className="listbutton",S.innerHTML="Ground >",S.setAttribute("onClick","showDropdownGround(this)"),d.appendChild(l),g.appendChild(F),g.appendChild(E),g.appendChild(K),C.appendChild(N),C.appendChild(w),C.appendChild(y),C.appendChild(f),C.appendChild(b),C.appendChild(x),C.appendChild(v),g.appendChild(C),g.appendChild(Q),M.appendChild(S),D.appendChild(_),D.appendChild(z),M.appendChild(D),m.appendChild(h),p.appendChild(g),p.appendChild(q),u.appendChild(M),i.appendChild(s),i.appendChild(X),r.appendChild(Y),r.appendChild(m),r.appendChild(j),r.appendChild(p),r.appendChild(Z),r.appendChild(u),r.appendChild(V),i.appendChild(r),i.appendChild(G),o.appendChild(ee),o.appendChild(a),o.appendChild(te),o.appendChild(i),o.appendChild(ne),o.appendChild(P),o.appendChild(oe),o.appendChild(d),o.appendChild(de),n.appendChild(R),n.appendChild(o),n.appendChild(U),n.appendChild(c),n.appendChild(W),document.body.appendChild(n),update(),n}function deletePostIt(e){e.remove()}function changeColor(e){color=e.innerHTML,elmnt=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,text_area=elmnt.childNodes[3],elmnt.style.backgroundColor=color,text_area.style.backgroundColor=color}function showDropdownColor(e){e.parentElement.classList.toggle("showcolor")}function showDropdownGround(e){e.parentElement.classList.toggle("showground")}function indexUp(e){elmnt=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,zIndex=parseInt(elmnt.style.zIndex),newZIndex=zIndex+1,elmnt.style.zIndex=newZIndex.toString()}function indexDown(e){elmnt=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement,elmnt.style.zIndex-=1}update(),$(function(){window.location.protocol;const e=JSON.parse(document.getElementById("session").textContent);var t=new ReconnectingWebSocket("ws://"+window.location.host+"/ws/IdeaPost/"+e+"/"),n={};t.onclose=function(e){console.error(e)},t.onmessage=function(e){var t=JSON.parse(e.data);console.log(t),"write"==t.send_type?t.cookie!=document.cookie&&(document.getElementById(t.id).childNodes[3].value=t.content):"move"==t.send_type?t.cookie!=document.cookie&&(document.getElementById(t.id).style.top=t.top+"px",document.getElementById(t.id).style.left=t.left+"px",document.getElementById(t.id).style.backgroundColor=t.color,document.getElementById(t.id).childNodes[3].style.backgroundColor=t.color,document.getElementById(t.id).childNodes[3].style.zIndex=t.zIndex):"resize"==t.send_type?t.cookie!=document.cookie&&(document.getElementById(t.id).childNodes[3].style.width=t.width-20+"px",document.getElementById(t.id).childNodes[3].style.height=t.height-4+"px"):"create"==t.send_type?t.cookie!=document.cookie&&createPostIt(t.author):"delete"==t.send_type?t.cookie!=document.cookie&&(postIt=document.getElementById(t.id),deletePostIt(postIt)):"save"==t.send_type&&t.cookie==document.cookie&&$("#saveMark").html("Saved ✔")},$(document).on("mousedown",".draggable",function(e){"TEXTAREA"==e.target.nodeName&&(n.width=e.target.style.width,n.height=e.target.style.height)}),$(document).on("click",".draggable",function(e){if("DIV"==e.target.nodeName||"IMG"==e.target.nodeName||"H3"==e.target.nodeName||"BUTTON"==e.target.nodeName){for(var o=e.target.parentElement;!o.classList.contains("draggable");)o=o.parentElement;var d=postItSyncEle(o,"move");return t.send(JSON.stringify(d)),$("#saveMark").html("Changes are not saved ✖"),!1}if("TEXTAREA"==e.target.nodeName&&e.target.style.width!=n.width){d=postItSyncEle(e.target.parentElement,"resize");return t.send(JSON.stringify(d)),$("#saveMark").html("Changes are not saved ✖"),!1}return!1}),$(".textarea").bind("input propertychange",function(e){var n=postItSyncEle(e.target.parentElement,"write");return t.send(JSON.stringify(n)),!1}),$(document).on("click","#saveButton",function(n){var o={},d=[];for(let e of $(".draggable"))d.push(postItSyncEle(e,"save"));return o.content=d,o.send_type="save",o.session_code=e,o.cookie=document.cookie,t.send(JSON.stringify(o)),!1}),$(document).on("click",".deleteButton",function(n){postItToDelete=n.target.parentElement.parentElement.parentElement.parentElement.parentElement;var o=postItSyncEle(postItToDelete,"delete");return o.session_code=e,deletePostIt(postItToDelete),t.send(JSON.stringify(o)),!1}),$(document).on("click","#createButton",function(n){return postAuthor=JSON.parse(document.getElementById("username").textContent),newPostIt=createPostIt(postAuthor),message=postItSyncEle(newPostIt,"create"),message.session_code=e,console.log(message),t.send(JSON.stringify(message)),!1})}),Array.from(document.getElementsByClassName("dropdown")).forEach(function(e){e.addEventListener("click",function(e){var t=(e=e||window.event).target||e.srcElement;t.textContent||t.innerText;t.parentElement.classList.toggle("show")})}),window.onclick=function(e){null!=e.target.parentElement&&(e.target.parentElement.classList.contains("dropdown")||e.target.parentElement.classList.contains("dropdowncolor")||e.target.parentElement.classList.contains("dropdownground"))?e.target.parentElement.classList.contains("dropdowncolor")?Array.from(document.getElementsByClassName("dropdown")).forEach(function(e){e.childNodes[2].childNodes[5].childNodes[0].classList.remove("showground"),e.childNodes[2].childNodes[5].childNodes[0].classList.remove("show")}):e.target.parentElement.classList.contains("dropdownground")&&Array.from(document.getElementsByClassName("dropdown")).forEach(function(e){e.childNodes[2].childNodes[3].childNodes[0].classList.remove("showcolor"),e.childNodes[2].childNodes[3].childNodes[0].classList.remove("show")}):Array.from(document.getElementsByClassName("dropdown")).forEach(function(e){e.classList.remove("show"),e.childNodes[2].childNodes[3].childNodes[0].classList.remove("showcolor"),e.childNodes[2].childNodes[3].childNodes[0].classList.remove("show"),e.childNodes[2].childNodes[5].childNodes[0].classList.remove("showground"),e.childNodes[2].childNodes[5].childNodes[0].classList.remove("show")})};